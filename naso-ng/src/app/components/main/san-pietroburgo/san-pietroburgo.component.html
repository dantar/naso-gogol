<svg class="fullsvg" viewBox="0 0 100 100" (pan)="onPan($event)" style="background-color:white">

    <defs>
        <g id="transparent-layer">
            <rect x="-200" y="-100" width="500" height="300" style="fill:black; opacity: 0;"></rect>
        </g>
        <g id="tutorial-pointer">
            <path
                style="opacity:1;vector-effect:none;fill:#ff7f2a;fill-opacity:1;stroke:none;stroke-width:0.20145686;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:markers fill stroke"
                d="m 0.3717935,-1.8265427 c 0.870507,0.01662 1.791673,0.615866 2.187695,1.47275998 l 0.180209,0.390323 0.01968,2.00237102 0.01928,2.002372 0.204213,-0.05233 c 0.112427,-0.02876 0.438568,-0.05043 0.724772,-0.0484 0.454293,0.0032 0.574414,0.02998 0.945116,0.212472 0.233543,0.114974 0.566694,0.351464 0.740511,0.525283 l 0.31635,0.315957 0.401341,-0.135746 c 0.31726,-0.10734 0.509009,-0.130308 0.915605,-0.109385 0.935638,0.04815 1.705248,0.550733 2.0846065,1.361407 l 0.188866,0.403702 0.236476,-0.06689 c 0.130113,-0.03679 0.43808,-0.06749 0.684244,-0.06807 1.011275,-0.0024 1.905345,0.627624 2.269932,1.599458 0.13529,0.360632 0.138078,0.427792 0.109777,2.7354057 -0.03431,2.79789 -0.08849,3.204948 -0.836124,6.298282 -0.539854,2.233645 -0.672131,3.062459 -0.763332,4.780272 -0.02441,0.459714 -0.156156,0.688316 -0.496954,0.862094 -0.203318,0.103673 -0.586225,0.111822 -5.2705365,0.110565 -4.470835,-0.0012 -5.074801,-0.01297 -5.25597704,-0.102302 -0.306203,-0.150988 -0.40497096,-0.355739 -0.46901796,-0.971479 -0.06468,-0.621832 -0.26389,-1.191421 -0.578008,-1.652576 -0.115906,-0.17016 -0.589533,-0.783916 -1.052533,-1.364162 -0.462997,-0.580246 -1.000844,-1.285468 -1.195363,-1.566799 -0.53548,-0.774462 -1.445422,-2.39229 -2.249864,-4.000808 -1.143632,-2.286745 -1.485672,-3.2850947 -1.426331,-4.1605557 0.06509,-0.960281 0.640768,-1.558203 1.669496,-1.734418 0.826736,-0.141614 1.725572,0.291954 2.682287,1.293337 0.270311,0.282931 0.505707,0.514267 0.522923,0.514267 0.01721,0 0.03148,-1.98073 0.03148,-4.401754 0,-4.12566302 0.0073,-4.42457102 0.11922,-4.76374702 0.291796,-0.88449298 0.990366,-1.46950898 1.971681,-1.65139498 0.120614,-0.02236 0.24393,-0.03189 0.368289,-0.02951 z"
                id="path993" />
            <path
                style="opacity:1;vector-effect:none;fill:#ffccaa;fill-opacity:1;stroke:none;stroke-width:0.20145686;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:markers fill stroke"
                d="m 0.3839895,-0.39509672 c -0.353422,0.0053 -0.52498604,0.09451 -0.68424404,0.355698 -0.12074096,0.19802 -0.12453296,0.382758 -0.12827196,6.59771202 -0.0029,4.7787747 -0.02323,6.4498147 -0.08027,6.6154177 -0.207871,0.603537 -1.13108,0.686654 -1.420033,0.127878 -0.05455,-0.10549 -0.12267,-0.447096 -0.151488,-0.759398 -0.04671,-0.506177 -0.08556,-0.629399 -0.358057,-1.133982 -0.753951,-1.396094 -1.982054,-2.7078637 -2.535131,-2.7078637 -0.232945,0 -0.374976,0.211733 -0.374976,0.559909 0,0.467587 0.597664,1.8550067 1.636837,3.7997437 1.198014,2.241996 1.745698,3.104931 2.832592,4.463529 0.436122,0.545146 0.950419,1.231415 1.143032,1.525091 0.35983,0.548633 0.738763,1.391536 0.816058,1.815866 l 0.04368,0.240017 h 4.17118 4.1711805 l 0.04092,-0.559515 c 0.06349,-0.869177 0.316231,-2.250434 0.768842,-4.204232 0.513272,-2.215662 0.530068,-2.302961 0.648045,-3.324431 0.06445,-0.558042 0.09617,-1.450122 0.09601,-2.717307 -2.01e-4,-1.7794757 -0.0077,-1.8987457 -0.129452,-2.0983777 -0.133431,-0.218852 -0.456116,-0.395437 -0.722019,-0.395437 -0.221178,0 -0.569626,0.25558 -0.698804,0.512691 -0.0857,0.170584 -0.112062,0.383228 -0.112139,0.910884 -1.27e-4,0.687675 -1.13e-4,0.688381 -0.207752,0.9132447 C 8.8983715,10.41428 8.5927975,10.48281 8.2565525,10.342318 7.8122205,10.156663 7.7950205,10.084494 7.7592055,8.2667603 l -0.03227,-1.62267 -0.238835,-0.21877 c -0.203647,-0.186509 -0.284816,-0.218771 -0.55086,-0.218771 -0.330488,0 -0.575292,0.135819 -0.729101,0.404488 -0.05197,0.09078 -0.09046,0.554205 -0.111351,1.337012 l -0.03227,1.197725 -0.208933,0.208933 c -0.184996,0.184843 -0.249283,0.208539 -0.558334,0.208539 -0.309061,0 -0.372941,-0.02407 -0.557941,-0.208933 l -0.209328,-0.208539 -0.03187,-1.613622 c -0.02308,-1.164647 -0.05544,-1.654068 -0.116073,-1.760387 -0.128359,-0.225049 -0.457658,-0.395955 -0.76412,-0.396225 -0.221442,-1.91e-4 -0.317559,0.04076 -0.511511,0.218377 l -0.238837,0.218768 -0.03187,1.204021 c -0.02092,0.787733 -0.05932,1.252028 -0.111353,1.342914 -0.217962,0.380735 -0.703212,0.515805 -1.105652,0.307695 -0.391376,-0.20239 -0.381557,-0.08855 -0.381666,-4.423789 -6.4e-5,-3.63556602 -0.0089,-3.96867702 -0.111746,-4.17039302 -0.163728,-0.321092 -0.404667,-0.473319 -0.741299,-0.46823 z"
                id="rect986" />
        </g>

        <g id="pin-visited">
            <circle cx="0" cy="0" r="60" style="fill:#cd1719;"></circle>
        </g>
        <g id="pin-A">
            <image width="155.90056" height="149.2946" preserveAspectRatio="none"
                xlink:href="./assets/Kazan-icon-02.png" x="-78.055603" y="-74.331604" />
        </g>
        <g id="pin-B">
            <image xlink:href="./assets/Nevskij-icon-02.png" y="-64.16906" x="-71.432701" preserveAspectRatio="none"
                height="140.48317" width="140.48317" />
        </g>
        <g id="pin-C">
            <image xlink:href="./assets/Torta-icon.png" y="-65.815506" x="-63.735977" id="location-torta"
                preserveAspectRatio="none" height="132.93289" width="132.93289" />
        </g>
        <g id="pin-D">
            <image xlink:href="./assets/Polizia-icon.png" y="-69.052467" x="-63.357803" id="location-capitano"
                preserveAspectRatio="none" height="139.72" width="137.65979" />
        </g>
        <g id="pin-E">
            <image xlink:href="./assets/Palazzo-di-Tauride-icon.png" y="-66.047112" x="-64.292435" id="location-tauride"
                preserveAspectRatio="none" height="132.42538" width="132.42538" />
        </g>
        <g id="pin-F">
            <image xlink:href="./assets/Giornale-icon.png" y="-69.385002" x="-65.510002" id="location-giornale"
                preserveAspectRatio="none" height="139.52" width="139.52" />
        </g>
        <g id="pin-G">
            <image xlink:href="./assets/esculapio-icon_2.png" y="-72.072189" x="-75.120811" id="location-medico"
                preserveAspectRatio="none" height="149.17531" width="149.17531" />
        </g>
        <g id="pin-H">
            <image xlink:href="./assets/Due-lettere-icon.png" y="-61.674915" x="-69.752647" id="location-lettere"
                preserveAspectRatio="none" height="134.97273" width="149.27946" />
        </g>
        <g id="pin-I">
            <image xlink:href="./assets/Casa di Kovalev-icon.png" y="-66.797112" x="-63.417435" id="location-casa"
                preserveAspectRatio="none" height="129.7" width="129.7" />
        </g>
        <g id="pin-J">
            <circle cx="0" cy="0" r="50" style="fill:#fff290;"></circle>
        </g>
        <g id="location-visited">
            <path
                d="m 45.988505,-63.184546 q 2.041374,0 3.949612,3.106438 1.908239,3.062063 1.908239,6.346011 0,5.369701 -3.949612,10.251242 -3.283948,4.082747 -5.458456,4.082747 -0.7988,0 -0.7988,-0.710044 0,-0.48816 0.754425,-0.97631 1.597593,-1.020684 2.884548,-3.372702 1.331329,-2.396393 1.331329,-4.171502 0,-5.014677 -4.748412,-7.677334 -1.242574,-0.710045 -1.242574,-1.464464 0,-0.710045 0.798799,-1.464464 l 1.908239,-1.730729 1.641974,-1.908244 q 0.35503,-0.310671 1.020689,-0.310671 z"
                style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:semi-expanded;font-size:medium;line-height:1.25;font-family:'Goudy Old Style';-inkscape-font-specification:'Goudy Old Style, Semi-Expanded';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-feature-settings:normal;text-align:center;letter-spacing:0px;word-spacing:0px;writing-mode:lr-tb;text-anchor:middle;fill:#cd1719;fill-opacity:1;stroke:#800000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
        </g>
    </defs>

    <g style="display:inline" id="layer1">
        <use href="#transparent-layer"></use>
        <image width="139.72601" height="100" preserveAspectRatio="none" xlink:href="assets/pietroburgo.jpg"
            id="image110" x="-19.863007" y="1.2694414e-08" />
    </g>

    <g [@fadefullmini]="location && location.state || 'mini'">
        <rect x="-20" y="0" width="140" height="300" style="fill:white;"></rect>
    </g>

    <g id="fiori-verticali">
        <image width="103.35194" height="25.387461" preserveAspectRatio="none" xlink:href="./assets/fiori-rossi.png"
            id="image125-3" x="-0.72895426" y="-146.81635" style="display:inline" transform="rotate(90)" />
        <image transform="matrix(0,1,1,0,0,0)" style="display:inline" y="-46.821114" x="-0.72895426" id="image1106"
            xlink:href="./assets/fiori-rossi.png" preserveAspectRatio="none" height="25.387461" width="103.35194" />
    </g>

    <g style="display:inline" id="layer2">
        <path id="segment" *ngIf="(visits.length > 0) && panEvent" [attr.d]="locsPathD(visits)"
            style="fill:none;stroke:#cd1719;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
        <g *ngIf="showNaso()" id="naso-mappa" [@nasopopup]="animationStateNasopopup()"
            (@nasopopup.done)="animationDoneNasopopup($event)">
            <image xlink:href="./assets/naso.png" width="69.32" height="100" preserveAspectRatio="none" id="image1056"
                x="-20" y="-25" style="display:inline" />
        </g>
        <use *ngFor="let location of visits" href="#pin-visited" [attr.transform]="moveToLocation(location)"></use>

        <g *ngFor="let loc of locations">
            <g [@names]="locationStateName(loc)" app-location-underline [text]="loc.track.title"></g>
            <g [@location]="locationStatePin(loc)">
                <use [attr.href]="'#pin-'+loc.name"></use>
                <!-- <use *ngIf="loc && loc.listen && loc.state === 'mini'" href="#location-visited"></use> -->
            </g>

            <g [@fadefullmini]="loc!=location && location && location.state || 'mini'">
                <circle cx="0" cy="0" r="50" style="opacity: 0.9; fill:#ffffff;" [@location]="locationStatePin(loc)">
                </circle>
            </g>
        </g>
        <g (click)="clickedScreen($event)">
            <use href="#transparent-layer"></use>
        </g>
        <circle *ngFor="let loc of locations" cx="0" cy="0" r="50" style="opacity: 0; fill:blueviolet;"
            [@location]="locationStatePin(loc)" (@location.done)="animationLocationDone($event, loc)"
            (click)="clickLocation(loc)" (touchstart)="onTouchStart($event, loc)"
            (mousedown)="onTouchStart($event, loc)"></circle>
    </g>

    <g *ngIf="tutorial1.show || tutorial2.show">
        <use href="#transparent-layer"></use>
    </g>

    <g *ngIf="tutorial2.show" (click)="clickTutorial(tutorial2)" @zoominout>
        <image transform="rotate(-15)" width="63.720203" height="83.185646" preserveAspectRatio="none"
            xlink:href="./assets/tutorial-02.png" id="tutorial-02" x="36.24765" y="33.87524" style="display:inline" />
    </g>

    <g *ngIf="tutorial1.show" (click)="clickTutorial(tutorial1)" @zoominout>
        <image transform="rotate(15)" width="63.720203" height="83.185646" preserveAspectRatio="none"
            xlink:href="./assets/tutorial-01.png" id="tutorial-01" x="-3.9376202" y="0.18116643"
            style="display:inline" />
    </g>

    <g *ngIf="unlocked">
        <g transform="translate(50 60) scale(1.5)">
            <image [@zoominout] width="43.809399" height="60.932877" preserveAspectRatio="none"
                xlink:href="./assets/naso.png" x="-22.227919" y="-38.775108" style="display:inline" />
        </g>
    </g>

</svg>

<app-listen-track *ngIf="track" (ended)="trackEnded($event)" [track]="track"></app-listen-track>

<div class="panel-menu-list top-left-menu">
    <div class="panel-menu-item" (click)="clickGoBack()">
        <svg viewBox="0 0 100 100">
            <g app-go-back></g>
        </svg>
    </div>
    <div class="panel-menu-item">
        <app-fullscreen-toggle></app-fullscreen-toggle>
    </div>
</div>